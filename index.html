<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Search Products</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; margin: 0; padding: 40px 20px; display: flex; flex-direction: column; align-items: center; }
    h1 { font-size: 2.5rem; color: #333; margin-bottom: 20px; }
    #searchBox { padding: 12px 20px; font-size: 18px; border: 2px solid #ccc; border-radius: 10px; width: 90%; max-width: 500px; margin-bottom: 30px; }
    .product-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; width: 100%; max-width: 1200px; }
    .product { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); flex: 1 1 280px; max-width: 280px; text-align: center; }
    .product img { width: 100%; height: auto; margin-bottom: 15px; border-radius: 8px; }
    .buy-btn { background: #ff4747; color: #fff; padding: 10px 15px; text-decoration: none; border-radius: 5px; display: inline-block; font-weight: bold; margin-top: 10px; }
    .loading, .error { font-size: 1.1rem; margin-top: 20px; color: #555; }
    .error { color: #b00; }
  </style>
</head>
<body>
  <h1>Find Your Product</h1>
  <input type="text" id="searchBox" placeholder="Search by code or name..." disabled />
  <div id="result" class="product-list"></div>

  <script>
    const sheetId = '1BQ6p45t85l9vi05NW_orX38P2f1fkLiEF65qyRLlb_o';
    const sheetName = 'Sheet1';
    let products = [];
    const input = document.getElementById('searchBox');
    const resultDiv = document.getElementById('result');

    // Fetch via Google Visualization API
    async function loadProducts() {
      resultDiv.innerHTML = '<p class="loading">Loading product data...</p>';
      try {
        const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?sheet=${sheetName}`;
        const res = await fetch(url);
        const text = await res.text();
        const jsonText = text.match(/setResponse\(([^]*?)\);/)[1];
        const data = JSON.parse(jsonText);
        const cols = data.table.cols.map(c => c.label);
        products = data.table.rows.map(r => {
          const obj = {};
          r.c.forEach((cell, i) => { obj[cols[i]] = cell ? cell.v : ''; });
          return obj;
        });
        input.disabled = false;
        renderProducts(products);
      } catch (err) {
        resultDiv.innerHTML = `<p class="error">Error loading products: ${err.message}</p>`;
      }
    }

    function renderProducts(list) {
      if (!list.length) {
        resultDiv.innerHTML = '<p class="error">No products available.</p>';
        return;
      }
      resultDiv.innerHTML = list.map(item => `
        <div class="product">
          <h3>${item['Name'] || 'Unnamed Product'}</h3>
          <img src="${item['Image URL']}" alt="${item['Name']}" />
          <a class="buy-btn" href="${item['AliExpress Link']}" target="_blank">Buy on AliExpress</a>
        </div>
      `).join('');
    }

    function filterProducts(term) {
      const keyword = term.trim().toUpperCase();
      if (!keyword) return renderProducts(products);
      const filtered = products.filter(item => {
        const code = (item['Product Code'] || '').toUpperCase();
        const name = (item['Name'] || '').toUpperCase();
        return code.includes(keyword) || name.includes(keyword);
      });
      if (filtered.length) renderProducts(filtered);
      else resultDiv.innerHTML = `<p class="error">No product found for: <strong>${keyword}</strong></p>`;
    }

    window.addEventListener('DOMContentLoaded', loadProducts);
    input.addEventListener('input', e => filterProducts(e.target.value));
  </script>
</body>
</html>
