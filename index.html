<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Search Products</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; margin: 0; padding: 40px 20px; display: flex; flex-direction: column; align-items: center; }
    h1 { font-size: 2.5rem; color: #333; margin-bottom: 20px; }
    #searchBox { padding: 12px 20px; font-size: 18px; border: 2px solid #ccc; border-radius: 10px; width: 90%; max-width: 500px; margin-bottom: 30px; }
    .product-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; width: 100%; max-width: 1200px; }
    .product { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); flex: 1 1 280px; max-width: 280px; text-align: center; }
    .product img { width: 100%; height: auto; margin-bottom: 15px; border-radius: 8px; }
    .buy-btn { background: #ff4747; color: #fff; padding: 10px 15px; text-decoration: none; border-radius: 5px; display: inline-block; font-weight: bold; margin-top: 10px; }
    .loading, .error { font-size: 1.1rem; margin-top: 20px; color: #555; }
    .error { color: #b00; }
    #loadMore { margin: 20px; padding: 10px 20px; font-size: 16px; border: none; border-radius: 5px; background: #007bff; color: #fff; cursor: pointer; }
  </style>
  <script src="https://unpkg.com/papaparse@5.3.1/papaparse.min.js"></script>
</head>
<body>
  <h1>Find Your Product</h1>
  <input type="text" id="searchBox" placeholder="Search by code or name..." disabled />
  <div id="result" class="product-list"></div>
  <button id="loadMore" style="display:none;">Load More</button>

  <script>
    const pubId = '2PACX-1vS9Yg6etFwOX1L-t2lnOX08ODcj6Z4xnPCCfuqMkZLrtNknP1jNThnvh64s96eTN6hbOq_aP0NBnOSW';
    const csvURL = `https://docs.google.com/spreadsheets/d/e/${pubId}/pub?output=csv`;
    let products = [], filtered = [], pageSize = 20, currentIndex = 0;
    const input = document.getElementById('searchBox');
    const resultDiv = document.getElementById('result');
    const loadBtn = document.getElementById('loadMore');

    window.addEventListener('DOMContentLoaded', () => {
      resultDiv.innerHTML = '<p class="loading">Loading products...</p>';
      Papa.parse(csvURL, {
        download: true, header: true, skipEmptyLines: true,
        complete: results => {
          products = results.data;
          input.disabled = false;
          resultDiv.innerHTML = '';
        },
        error: err => { resultDiv.innerHTML = `<p class="error">Error loading products: ${err.message}</p>`; }
      });
    });

    function renderPage() {
      const slice = filtered.slice(currentIndex, currentIndex + pageSize);
      slice.forEach(item => {
        const card = document.createElement('div'); card.className='product';
        card.innerHTML = `<h3>${item['Name']||'Unnamed'}</h3>
                          <img src="${item['Image URL']}" alt="${item['Name']}" />
                          <a class="buy-btn" href="${item['AliExpress Link']}" target="_blank">Buy on AliExpress</a>`;
        resultDiv.appendChild(card);
      });
      currentIndex += slice.length;
      if (currentIndex < filtered.length) loadBtn.style.display='block';
      else loadBtn.style.display='none';
    }

    function doSearch() {
      const term = input.value.trim().toUpperCase();
      resultDiv.innerHTML = '';
      currentIndex = 0;
      filtered = products.filter(item => {
        const code = (item['Product Code']||'').toUpperCase();
        const name = (item['Name']||'').toUpperCase();
        return code.includes(term) || name.includes(term);
      });
      if (filtered.length) renderPage();
      else resultDiv.innerHTML = `<p class="error">No product found for: <strong>${term}</strong></p>`;
    }

    input.addEventListener('input', () => {
      if (!input.value.trim()) { resultDiv.innerHTML=''; loadBtn.style.display='none'; return; }
      doSearch();
    });
    loadBtn.addEventListener('click', renderPage);
  </script>
</body>
</html>
