<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Search Products</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; margin: 0; padding: 40px 20px; display: flex; flex-direction: column; align-items: center; }
    h1 { font-size: 2.5rem; color: #333; margin-bottom: 20px; }
    #searchBox { padding: 12px 20px; font-size: 18px; border: 2px solid #ccc; border-radius: 10px; width: 90%; max-width: 500px; margin-bottom: 30px; }
    .product-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; width: 100%; max-width: 1200px; }
    .product { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); flex: 1 1 280px; max-width: 280px; text-align: center; }
    .product img { width: 100%; height: auto; margin-bottom: 15px; border-radius: 8px; }
    .buy-btn { background: #ff4747; color: #fff; padding: 10px 15px; text-decoration: none; border-radius: 5px; display: inline-block; font-weight: bold; margin-top: 10px; }
    .loading, .error { font-size: 1.1rem; margin-top: 20px; color: #555; }
    .error { color: #b00; }
  </style>
</head>
<body>
  <h1>Find Your Product</h1>
  <input type="text" id="searchBox" placeholder="Search by code or name..." disabled />
  <div id="result" class="product-list"></div>

  <!-- Tabletop.js for JSON fetch from Google Sheets -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js"></script>
  <script>
    // Make sure your sheet is published to web (File > Publish to web)
    const sheetId = '1BQ6p45t85l9vi05NW_orX38P2f1fkLiEF65qyRLlb_o';
    let products = [];
    const input = document.getElementById('searchBox');
    const resultDiv = document.getElementById('result');

    // Load data
    window.addEventListener('DOMContentLoaded', () => {
      resultDiv.innerHTML = '<p class="loading">Loading products...</p>';
      Tabletop.init({
        key: sheetId,
        simpleSheet: true,
        callback: data => {
          products = data;
          input.disabled = false;
          renderProducts(products);
        },
        error: err => {
          resultDiv.innerHTML = `<p class="error">Error loading products: ${err}</p>`;
        }
      });
    });

    // Render product cards
    function renderProducts(list) {
      if (!list || list.length === 0) {
        resultDiv.innerHTML = '<p class="error">No products available.</p>';
        return;
      }
      resultDiv.innerHTML = list.map(item => `
        <div class="product">
          <h3>${item.name || 'Unnamed Product'}</h3>
          <img src="${item.imageURL || ''}" alt="${item.name}" />
          <a class="buy-btn" href="${item.aliExpressLink || '#'}" target="_blank">Buy on AliExpress</a>
        </div>
      `).join('');
    }

    // Filter by code or name
    input.addEventListener('input', e => {
      const term = e.target.value.trim().toUpperCase();
      if (!term) return renderProducts(products);
      const filtered = products.filter(item => {
        const code = (item.productCode || '').toUpperCase();
        const name = (item.name || '').toUpperCase();
        return code.includes(term) || name.includes(term);
      });
      if (filtered.length) renderProducts(filtered);
      else resultDiv.innerHTML = `<p class="error">No product found for: <strong>${term}</strong></p>`;
    });
  </script>
</body>
</html>
